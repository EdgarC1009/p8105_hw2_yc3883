---
title: "P8105_HW2"
author: Yijia Chen
date: 2021-10-05
output: github_document
---

```{r, message = FALSE}
library(tidyverse)
library(readxl)
```

# Problem 1
## Problem 1 (1)

Read and clean the Mr. Trash Wheel sheet:

1. specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
2. use reasonable variable names
3. omit rows that do not include dumpster-specific data
4. round the number of sports balls to the nearest integer

```{r}
trashw_df = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N408") %>%
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = round(sports_balls))
```

## Problem 1 (2)

Read and clean precipitation data for 2018 and 2019. For each, omit rows without precipitation data and add a variable for year. Next, combine precipitation datasets and convert month to a character variable.

```{r}

pdata_2019_df = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "2019 Precipitation", range = "A2:B14") %>%   janitor::clean_names() %>% 
  mutate(year = 2019)

pdata_2018_df = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "2018 Precipitation", range = "A2:B14") %>%   janitor::clean_names() %>% 
  mutate(year = 2018)

pdata_df = 
  bind_rows(pdata_2018_df, pdata_2019_df) %>% 
  mutate(month = month.abb[month]) %>% 
  rename(total_precipitation = total) %>% 
  relocate(year)

```

# Problem 2

First, clean the data in pols-month.csv. Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.

```{r}
pols_df = 
  read_csv("data/fivethirtyeight/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day")) %>% 
  mutate(
    month = as.numeric(month),
    month = month.abb[month],
    date = paste(year, month)) %>% 
  pivot_longer(
    c(prez_gop,prez_dem),
    names_to = "president",
    names_prefix = "prez_",
    values_to = "presidency"
  ) %>% 
  filter(presidency != 0) %>% 
  select(-c(year, month, day, presidency)) %>% 
  relocate(date)
```

Second, clean the data in snp.csv using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.

```{r}
snp_df = 
  read.csv("data/fivethirtyeight/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = lubridate::mdy(date)) %>% 
  separate(date, into = c("year", "month", "day")) %>% 
  mutate(
    year = as.numeric(year),
    year = ifelse(year > 2021, year - 100, year),
    month = as.numeric(month),
    month = month.abb[month],
    date = paste(year, month)
    ) %>% 
  select(-c(year, month, day)) %>% 
  relocate(date)
```

Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r}
unemploy_df = 
  read.csv("data/fivethirtyeight/unemployment.csv") %>% 
  pivot_longer(
    c(Jan:Dec),
    names_to = "month",
    values_to = "percent_unemploy"
  ) %>% 
  janitor::clean_names() %>% 
  mutate(date = paste(year, month)) %>% 
  select(-c(year, month)) %>% 
  relocate(date)
```

Join the datasets by merging snp into pols, and merging unemployment into the result.

```{r}
union2_df = 
  full_join(pols_df, snp_df, by = "date")

union3_df = 
  full_join(union2_df, unemploy_df, by = "date")
```

